Copyright © Microsoft Corporation. All rights reserved.
  适用于[License](https://github.com/Microsoft/ai-edu/blob/master/LICENSE.md)版权许可

# 分类函数

## 二分类函数 - Sigmoid

Sigmoid是激活函数，本身又可以当作二分类的分类函数。

###公式

$$a(z) = \frac{1}{1 + e^{-z}}$$

### 导数

$$a^{'}(z) = a(z)(1 - a(z))$$

### 输入值域

$[-\infin, \infin]$

### 输出值域

[0,1]

### 函数图像

<img src=".\Images\7\sigmoid.png">

### 工作原理

训练时，一个样本x在经过神经网络的最后一层的矩阵运算结果作为输入z，经过Sigmoid后，输出一个[0,1]之间的预测值。我们假设这个样本的标签值为0（属于负类，另外一类是第1类属于正类），如果其预测值越接近0，就越接近标签值，那么误差越小，反向传播的力度就越小。

推理时，我们预先设定一个阈值，比如上图中的红线，我们设置阈值=0.5，则当推理结果大于0.5时，认为是正类；小于0.5时认为是负类；等于0.5时，根据情况自己定义。阈值也不一定就是0.5，也可以是0.65等等，阈值越大，准确率越高，召回率越低；阈值越小则相反。


### 正向计算公式

$$
z_i = wx_i+b  \tag{1}
$$

$$
a_i={1 \over 1 + e^{-z_i}} \tag{2}
$$

$$
J(w,b) = -{1 \over m} \sum^m_{i=0}y_iln(a_i)+(1-y_i)ln(1-a_i) \tag{3}
$$

### 反向传播公式

$$
{\partial{J} \over \partial{a_i}}= -{1 \over m} \sum^m_{i=0} ({y_i \over a_i} - {1-y_i \over 1-a_i})
$$

$$
=-{1 \over m} \sum^m_{i=0}{y_i-a_i \over a_i(1-a_i)} \tag{4}
$$

$$
{\partial{a_i} \over \partial{z_i}}=a_i(1-a_i) \tag{5}
$$

所以，结合公式4,5：

$$
{\partial{J} \over \partial{z_i}}={\partial{J} \over \partial{a_i}}{\partial{a_i} \over \partial{z_i}}
$$

$$
=-{1 \over m} \sum^m_{i=0}{y_i-a_i \over a_i(1-a_i)} \cdot a_i(1-a_i)
$$

$$
=-{1 \over m} \sum^m_{i=0}(y_i-a_i)
$$

$$
={1 \over m} \sum^m_{i=0}(a_i-y_i) \tag{6}
$$

至此，我们得到了z的误差，进一步向后传播给w和b：

$${\partial{z_i} \over \partial{w}} = x_i$$

$$
{\partial{z_i} \over \partial{b}} = 1
$$

把公式6带过来：

$$
{\partial{J} \over \partial{w}}={\partial{J} \over \partial{z_i}}{\partial{z_i} \over \partial{w}}={1 \over m} \sum^m_{i=0}(a_i-y_i)x_i \tag{7}
$$

$$
{\partial{J} \over \partial{b}}={\partial{J} \over \partial{z_i}}{\partial{z_i} \over \partial{b}}={1 \over m} \sum^m_{i=0}(a_i-y_i) \tag{8}
$$

